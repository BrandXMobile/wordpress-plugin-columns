!function(e,n){tinymce.PluginManager.add("columns",function(t){function a(){var e='<table class="mce-grid mce-grid-border mce-columns-grid"><tbody>',n=columns_options.columns||9;e+='<tr style="display:none;"><td colspan="10">',e+='<input id="liquid-text" type="checkbox" />',e+='<label for="liquid-text">Liquid Text</label>',e+="</td></tr>",e+="<tr>";for(var t=1;t<=n;t++)e+='<td data-columns="'+t+'">',e+="<span>"+(t>1?t:"&times;")+"</span>",e+="</td>";for(e+="</tr>",e+="</tbody></table>",e+='<table class="mce-grid mce-grid-border mce-columns-grid"><tbody>',e+='<tr style="visibility:collapse;">',t=1;t<10;t++)e+="<td>&nbsp;</td>";return e+="</tr>",e+='<tr><td data-columns="narrow-wide" colspan="3">',e+="<span>1/3</span>",e+='</td><td data-columns="narrow-wide" colspan="6">',e+="<span>2/3</span>",e+="</td></tr>",e+='<tr><td data-columns="wide-narrow" colspan="6">',e+="<span>2/3</span>",e+='</td><td data-columns="wide-narrow" colspan="3">',e+="<span>1/3</span>",e+="</td></tr>",e+="</tbody></table>"}tinymce.PluginManager.requireLangPack("columns","de_DE"),t.addButton("columns",{type:"panelbutton",tooltip:t.getLang("columns.Columns"),icon:"columns",panel:{role:"application",html:a,onclick:function(a){function o(e){if(e)for(e=e.firstChild;e&&(!b||!y);)3==e.nodeType?(e.nodeValue.match(new RegExp("^\\[range-start-container\\]"))&&(e.nodeValue=e.nodeValue.replace("[range-start-container]",""),b=e),e.nodeValue.match(new RegExp("\\[range-end-container\\]$"))&&(e.nodeValue=e.nodeValue.replace("[range-end-container]",""),y=e)):1==e.nodeType&&o(e),e=e.nextSibling}var i,r,l=e(t.dom.getParent(t.selection.getNode(),".columns")),s=e("div.column",l),d=[],c="",u=e("#liquid-text").is(":checked"),m=t.selection.getRng();if(!e.isNumeric(a)&&l.length&&3==m.startContainer.nodeType&&!m.startContainer.textContent.trim()){for(var p=t.dom.getParent(m.startContainer.parentNode,".column");p.firstChild;)p.removeChild(p.firstChild);e(p).append("<p>"+t.getLang("columns.Column")+" "+(s.index(p)+1)+"</p>"),m.setStart(p.firstChild,1)}if(e.isNumeric(a)||"narrow-wide"==a||"wide-narrow"==a){if(i=a,p==n)return}else i=e(a.target).closest("td").data("columns"),this.hide();var g=m.startOffset,f=m.endOffset;if(l.length)if(m.startContainer.nodeValue="[range-start-container]"+m.startContainer.nodeValue,m.endContainer.nodeValue+="[range-end-container]",s.length)for(r=0;r<s.length;r++)d.push(s[r].innerHTML.trim());else d=[l[0].innerHTML.trim()];else d=[tinyMCE.activeEditor.selection.getContent()],d[0]&&(d[0]="<p>"+d[0]+"</p>");if(i==n)a.stopPropagation();else{if(1===i)c=d.join("");else{if(!e.isNumeric(i)){var v=i.split("-");i=v.length}for(c='<div class="columns columns-'+i+(u?" columns-liquid":"")+'" data-columns="'+i+'">',r=0;r<i;r++)r==i-1&&(d[r]=d.slice(r).join("")),u||(c+='<div class="column column-'+(r+1)+(v?" column-"+v[r]:"")+'">'),c+=d[r]||"<p>"+t.getLang("columns.Column")+" "+(r+1)+"</p>",u||(c+="</div>");c+="</div>"}var h=e(c),b=null,y=null;l.length?l.replaceWith(h):t.insertContent(c),h.each(function(){o(this)}),b&&y&&(m.setStart(b,g),m.setEnd(y,f),t.selection.setRng(m))}}},onPostRender:function(){t.on("init",function(){var n=t.dom.getParent(t.selection.getNode(),"body");e(n).on("mouseenter mouseleave","div.columns",function(n){var a=e(n.target);if(a.is(".columns")||(a=a.closest("div.columns")),"mouseleave"==n.type)a.find("span.add-paragraph").remove();else{var o=e('<span class="add-paragraph" />');o.attr("title",t.getLang("columns.AddParagraph")).on("click",function(){var n="after";e(this).is(":first-child")&&(n="before"),a[n]("<p>&nbsp;</p>")}),a.prepend(o).append(o.clone(!0))}})});for(var n=this,a=["nodechange","click","show"],o=0;o<a.length;o++)t.on(a[o],function(a){var o=t.dom.getParent(t.selection.getNode(),"body");e("div.columns",e(o)).removeClass("active");var i=t.dom.getParent(t.selection.getNode(),".columns");if(n.active(!!i),i){var r=e(i);if(r.addClass("active"),"click"==a.type){var l=r.find("div.column:first-of-type");i=l.hasClass("column-wide")?"wide-narrow":l.hasClass("column-narrow")?"narrow-wide":r.data("columns"),t.buttons.columns.panel.onclick(i)}}})}})})}(jQuery);