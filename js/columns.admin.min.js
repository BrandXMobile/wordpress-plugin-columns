!function(e,n){tinymce.PluginManager.add("columns",function(t){function a(e){return!isNaN(parseFloat(e))&&isFinite(e)}function o(){var e='<table class="mce-grid mce-grid-border mce-columns-grid"><tbody>';e+='<tr style="display:none;"><td colspan="10"><input id="liquid-text" type="checkbox" /><label for="liquid-text">Liquid Text</label></td></tr>',e+="<tr>";for(var n=1;10>n;n++)e+='<td data-columns="'+n+'"><span>'+(n>1?n:"&times;")+"</span></td>";return e+="</tr>",e+='<tr><td data-columns="narrow-wide" colspan="3"><span>1/3</span></td><td data-columns="narrow-wide" colspan="6"><span>2/3</span></td></tr>',e+='<tr><td data-columns="wide-narrow" colspan="6"><span>2/3</span></td><td data-columns="wide-narrow" colspan="3"><span>1/3</span></td></tr>',e+="</tbody></table>"}t.addButton("columns",{type:"panelbutton",tooltip:t.editorManager.i18n.translate("Columns"),icon:"columns",panel:{role:"application",html:o,onclick:function(o){var r,i,l=e(t.dom.getParent(t.selection.getNode(),".columns")),s=e("div.column",l),d=[],c="",u=e("#liquid-text").is(":checked"),p="insert",m=t.selection.getRng();if(3!=m.startContainer.nodeType&&!m.startContainer.textContent){for(var f=t.dom.getParent(m.startContainer.parentNode,".column");f.firstChild;)f.removeChild(f.firstChild);var g=document.createElement("p");g.appendChild(document.createTextNode("Â ")),f.appendChild(g),m.setStart(f.firstChild,1)}var v=m.startOffset,h=m.endOffset;if(l.length)if(p="replace",s.length)for(m.startContainer.nodeValue="[range-start-container]"+m.startContainer.nodeValue,m.endContainer.nodeValue+="[range-end-container]",i=0;i<s.length;i++)d.push(s[i].innerHTML.trim());else d=[l[0].innerHTML.trim()];else d=[tinyMCE.activeEditor.selection.getContent()],d[0]&&(d[0]="<p>"+d[0]+"</p>");if(a(o)||"narrow-wide"==o||"wide-narrow"==o?(r=o,p="refresh"):r=e(o.target).closest("td").data("columns"),r==n)o.stopPropagation();else{if(1===r)c=d.join("");else{if(!a(r)){var C=r.split("-");r=C.length}for(c='<div class="columns columns-'+r+(u?" columns-liquid":"")+'" data-columns="'+r+'">',i=0;r>i;i++)i==r-1&&(d[i]=d.slice(i).join("")),u||(c+='<div class="column column-'+(i+1)+(C?" column-"+C[i]:"")+'">'),c+=d[i]||"<p>"+t.editorManager.i18n.translate("Column")+" "+(i+1)+"</p>",u||(c+="</div>");c+="</div>"}"refresh"!=p&&this.hide();var w=e(c),y=null,b=null;l.length?(l.replaceWith(w),function x(e){if(e)for(e=e.firstChild;e&&(!y||!b);)3==e.nodeType?(e.nodeValue.match(new RegExp("^\\[range-start-container\\]"))&&(e.nodeValue=e.nodeValue.replace("[range-start-container]",""),y=e),e.nodeValue.match(new RegExp("\\[range-end-container\\]$"))&&(e.nodeValue=e.nodeValue.replace("[range-end-container]",""),b=e)):1==e.nodeType&&x(e),e=e.nextSibling}(w[0]),y&&b&&(m.setStart(y,v),m.setEnd(b,h),t.selection.setRng(m))):t.insertContent(c)}}},onPostRender:function(){var n=this,a=["nodechange","click","show"];t.on("init",function(){var n=t.dom.getParent(t.selection.getNode(),"body");e(n).on("mouseenter mouseleave","div.columns",function(n){var a=e(n.target);if(a.is(".columns")||(a=a.closest("div.columns")),"mouseleave"==n.type)a.find("span.add-paragraph").remove();else{var o=e('<span class="add-paragraph" />');o.attr("title",t.editorManager.i18n.translate("Add paragraph")).on("click",function(){e(this).is(":first-child")?a.before("<p>&nbsp;</p>"):a.after("<p>&nbsp;</p>")}),a.prepend(o).append(o.clone(!0))}})});for(var o=0;o<a.length;o++)t.on(a[o],function(a){var o=t.dom.getParent(t.selection.getNode(),"body");e("div.columns",e(o)).removeClass("active");var r=t.dom.getParent(t.selection.getNode(),".columns");if(n.active(!!r),r){var i=e(r);if(i.addClass("active"),"click"==a.type){var l=i.find("div.column:first-of-type");r=l.hasClass("column-wide")?"wide-narrow":l.hasClass("column-narrow")?"narrow-wide":i.data("columns"),t.buttons.columns.panel.onclick(r)}}})}})})}(jQuery);