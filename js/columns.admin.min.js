!function(e,n){tinymce.PluginManager.add("columns",function(t){function a(){var e='<table class="mce-grid mce-grid-border mce-columns-grid"><tbody>';e+='<tr style="display:none;"><td colspan="10">',e+='<input id="liquid-text" type="checkbox" />',e+='<label for="liquid-text">Liquid Text</label>',e+="</td></tr>",e+="<tr>";for(var n=1;10>n;n++)e+='<td data-columns="'+n+'">',e+="<span>"+(n>1?n:"&times;")+"</span>",e+="</td>";return e+="</tr>",e+='<tr><td data-columns="narrow-wide" colspan="3">',e+="<span>1/3</span>",e+='</td><td data-columns="narrow-wide" colspan="6">',e+="<span>2/3</span>",e+="</td></tr>",e+='<tr><td data-columns="wide-narrow" colspan="6">',e+="<span>2/3</span>",e+='</td><td data-columns="wide-narrow" colspan="3">',e+="<span>1/3</span>",e+="</td></tr>",e+="</tbody></table>"}function o(e){return!isNaN(parseFloat(e))&&isFinite(e)}tinymce.PluginManager.requireLangPack("columns","de_DE"),t.addButton("columns",{type:"panelbutton",tooltip:t.getLang("columns.Columns"),icon:"columns",panel:{role:"application",html:a,onclick:function(a){var r,i,l=e(t.dom.getParent(t.selection.getNode(),".columns")),s=e("div.column",l),d=[],c="",u=e("#liquid-text").is(":checked"),p="insert",m=t.selection.getRng();if(3!=m.startContainer.nodeType&&!m.startContainer.textContent){for(var g=t.dom.getParent(m.startContainer.parentNode,".column");g.firstChild;)g.removeChild(g.firstChild);var f=document.createElement("p");f.appendChild(document.createTextNode("Â ")),g.appendChild(f),m.setStart(g.firstChild,1)}var h=m.startOffset,v=m.endOffset;if(l.length)if(p="replace",s.length)for(m.startContainer.nodeValue="[range-start-container]"+m.startContainer.nodeValue,m.endContainer.nodeValue+="[range-end-container]",i=0;i<s.length;i++)d.push(s[i].innerHTML.trim());else d=[l[0].innerHTML.trim()];else d=[tinyMCE.activeEditor.selection.getContent()],d[0]&&(d[0]="<p>"+d[0]+"</p>");if(o(a)||"narrow-wide"==a||"wide-narrow"==a?(r=a,p="refresh"):r=e(a.target).closest("td").data("columns"),r==n)a.stopPropagation();else{if(1===r)c=d.join("");else{if(!o(r)){var w=r.split("-");r=w.length}for(c='<div class="columns columns-'+r+(u?" columns-liquid":"")+'" data-columns="'+r+'">',i=0;r>i;i++)i==r-1&&(d[i]=d.slice(i).join("")),u||(c+='<div class="column column-'+(i+1)+(w?" column-"+w[i]:"")+'">'),c+=d[i]||"<p>"+t.getLang("columns.Column")+" "+(i+1)+"</p>",u||(c+="</div>");c+="</div>"}"refresh"!=p&&this.hide();var C=e(c),y=null,b=null;l.length?(l.replaceWith(C),function P(e){if(e)for(e=e.firstChild;e&&(!y||!b);)3==e.nodeType?(e.nodeValue.match(new RegExp("^\\[range-start-container\\]"))&&(e.nodeValue=e.nodeValue.replace("[range-start-container]",""),y=e),e.nodeValue.match(new RegExp("\\[range-end-container\\]$"))&&(e.nodeValue=e.nodeValue.replace("[range-end-container]",""),b=e)):1==e.nodeType&&P(e),e=e.nextSibling}(C[0]),y&&b&&(m.setStart(y,h),m.setEnd(b,v),t.selection.setRng(m))):t.insertContent(c)}}},onPostRender:function(){t.on("init",function(){var n=t.dom.getParent(t.selection.getNode(),"body");e(n).on("mouseenter mouseleave","div.columns",function(n){var a=e(n.target);if(a.is(".columns")||(a=a.closest("div.columns")),"mouseleave"==n.type)a.find("span.add-paragraph").remove();else{var o=e('<span class="add-paragraph" />');o.attr("title",t.getLang("columns.AddParagraph")).on("click",function(){var n="after";e(this).is(":first-child")&&(n="before"),a[n]("<p>&nbsp;</p>")}),a.prepend(o).append(o.clone(!0))}})});for(var n=this,a=["nodechange","click","show"],o=0;o<a.length;o++)t.on(a[o],function(a){var o=(t.dom.getParent(t.selection.getNode(),"body"),t.dom.getParent(t.selection.getNode(),".columns"));if(n.active(!!o),o){var r=e(o);if("click"==a.type){var i=r.find("div.column:first-of-type");o=i.hasClass("column-wide")?"wide-narrow":i.hasClass("column-narrow")?"narrow-wide":r.data("columns"),t.buttons.columns.panel.onclick(o)}}})}})})}(jQuery);