!function(n,e){tinymce.PluginManager.add("columns",function(t){function a(){var n='<table class="mce-grid mce-grid-border mce-columns-grid"><tbody>',e=columns_options.columns||9;n+="<tr>";for(var t=1;t<=e;t++)n+='<td data-columns="'+t+'">',n+="<span>"+(t>1?t:"&times;")+"</span>",n+="</td>";for(n+="</tr>",n+="</tbody></table>",n+='<table class="mce-grid mce-grid-border mce-columns-grid"><tbody>',n+='<tr style="visibility:collapse;">',t=1;t<10;t++)n+="<td>&nbsp;</td>";return n+="</tr>",n+='<tr><td data-columns="narrow-wide" colspan="3">',n+="<span>1/3</span>",n+='</td><td data-columns="narrow-wide" colspan="6">',n+="<span>2/3</span>",n+="</td></tr>",n+='<tr><td data-columns="wide-narrow" colspan="6">',n+="<span>2/3</span>",n+='</td><td data-columns="wide-narrow" colspan="3">',n+="<span>1/3</span>",n+="</td></tr>",n+="</tbody></table>"}tinymce.PluginManager.requireLangPack("columns","de_DE"),t.addButton("columns",{type:"panelbutton",tooltip:t.getLang("columns.Columns"),icon:"columns",panel:{role:"application",html:a,onclick:function(a){function o(n){if(n)for(n=n.firstChild;n&&(!C||!w);)3==n.nodeType?(n.nodeValue.match(new RegExp("^\\[range-start-container\\]"))&&(n.nodeValue=n.nodeValue.replace("[range-start-container]",""),C=n),n.nodeValue.match(new RegExp("\\[range-end-container\\]$"))&&(n.nodeValue=n.nodeValue.replace("[range-end-container]",""),w=n)):1==n.nodeType&&o(n),n=n.nextSibling}var i,r,s=n(t.dom.getParent(t.selection.getNode(),".columns")),l=n("div.column",s),d=[],c="",u=n("#liquid-text").is(":checked"),m=t.selection.getRng();if(!n.isNumeric(a)&&s.length&&3==m.startContainer.nodeType&&!m.startContainer.textContent.trim()){for(var p=t.dom.getParent(m.startContainer.parentNode,".column");p.firstChild;)p.removeChild(p.firstChild);n(p).append("<p>"+t.getLang("columns.Column")+" "+(l.index(p)+1)+"</p>"),m.setStart(p.firstChild,1)}if(n.isNumeric(a)||"narrow-wide"==a||"wide-narrow"==a){if(i=a,p==e)return}else i=n(a.target).closest("td").data("columns"),this.hide();var g=m.startOffset,f=m.endOffset;if(s.length)if(m.startContainer.nodeValue="[range-start-container]"+m.startContainer.nodeValue,m.endContainer.nodeValue+="[range-end-container]",l.length)for(r=0;r<l.length;r++)d.push(l[r].innerHTML.trim());else d=[s[0].innerHTML.trim()];else d=[tinyMCE.activeEditor.selection.getContent()],d[0]&&(d[0]="<p>"+d[0]+"</p>");if(i==e)a.stopPropagation();else{if(1===i)c=d.join("");else{if(!n.isNumeric(i)){var v=i.split("-");i=v.length}for(c='<div class="columns columns-'+i+(u?" columns-liquid":"")+'" data-columns="'+i+'">',r=0;r<i;r++)r==i-1&&(d[r]=d.slice(r).join("")),u||(c+='<div class="column column-'+(r+1)+(v?" column-"+v[r]:"")+'">'),c+=d[r]||"<p>"+t.getLang("columns.Column")+" "+(r+1)+"</p>",u||(c+="</div>");c+="</div>"}var h=n(c),C=null,w=null;s.length?s.replaceWith(h):t.insertContent(c),h.each(function(){o(this)}),C&&w&&(m.setStart(C,g),m.setEnd(w,f),t.selection.setRng(m))}}},onPostRender:function(){t.on("init",function(){var e=t.dom.getParent(t.selection.getNode(),"body");n(e).on("mouseenter mouseleave","div.columns",function(e){var a=n(e.target);if(a.is(".columns")||(a=a.closest("div.columns")),"mouseleave"==e.type)a.find("span.add-paragraph").remove();else{var o=n('<span class="add-paragraph" />');o.attr("title",t.getLang("columns.AddParagraph")).on("click",function(){var e="after";n(this).is(":first-child")&&(e="before"),a[e]("<p>&nbsp;</p>")}),a.find("div.column:first-child").prepend(o),a.find("div.column:last-child").append(o.clone(!0))}})});for(var e=this,a=["nodechange","click","show"],o=0;o<a.length;o++)t.on(a[o],function(a){var o=t.dom.getParent(t.selection.getNode(),"body");n("div.columns",n(o)).removeClass("active");var i=t.dom.getParent(t.selection.getNode(),".columns");if(e.active(!!i),i){var r=n(i);if(r.addClass("active"),"click"==a.type){var s=r.find("div.column:first-of-type");i=s.hasClass("column-wide")?"wide-narrow":s.hasClass("column-narrow")?"narrow-wide":r.data("columns"),t.buttons.columns.panel.onclick(i)}}})}})})}(jQuery);